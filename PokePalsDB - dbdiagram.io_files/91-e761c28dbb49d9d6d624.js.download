(window.cbJsonP=window.cbJsonP||[]).push([[91],{168:function(e,t,n){"use strict";var a=n(8),s=n.n(a),i=n(2),r=n.n(i),o=n(5),c=n.n(o),d=n(4),u=n(26),l=n(0),m=n(7),h=n(13),f=n(21),A=n(17),w=n(6),g=window.addEventListener?"addEventListener":"attachEvent",p=window[g],v="attachEvent"==g?"onmessage":"message",y=(c()(S,[{key:"listen",value:function(){var c=this;p(v,function(a){if("object"==s()(a.data)&&a.data.cbEvent){var i=a.data;if((i.targetWindowName==window.name||c.windowType==l.n.Host&&i.targetWindowName==w.a.HOST_NAME)&&!(c.windowType==l.n.Component&&a.origin!=d.a.getJSDomainIframeCommunication()||c.windowType==l.n.Master&&a.origin!=d.a.getJSDomainIframeCommunication()&&a.source!==window.parent)){var r=i.replyId,o=i.srcWindowName,e=i.message;e.action&&(u.a.notTrue(function(){return c.windowType!=l.n.Component||i.srcWindowName==w.a.MASTER_FRAME},Object(f.d)(h.e.receiveMessageError)),m.a.resolve(e).then(function(e){if(i.srcWindowName!==i.targetWindowName){var t={replyId:r,message:e,cbEvent:!0,targetWindowName:i.srcWindowName};c.postMessage(o,t,a.origin)}}).catch(function(e){if(i.srcWindowName!==i.targetWindowName){var t=new h.a(e),n={replyId:r,error:Object(A.h)(t),message:e.message,cbEvent:!0,targetWindowName:i.srcWindowName};c.postMessage(o,n,a.origin)}}))}}})}},{key:"postMessage",value:function(e,t,n){var a=this;u.a.notTrue(function(){return a.windowType!=l.n.Component||e==w.a.MASTER_FRAME},Object(f.d)(h.e.responseError)),u.a.notTrue(function(){return a.windowType!=l.n.Component||n==d.a.getJSDomainIframeCommunication()},Object(f.d)(h.e.responseMismatchError));var i=this.getTargetWindow(e);try{Object(A.i)({targetWindow:i,message:t,targetIframeName:e,windowType:this.windowType,handlerType:l.m.Receiver})}catch(e){console.error(e)}Object(A.d)(i,t,n,l.m.Receiver)}},{key:"getTargetWindow",value:function(e){return this.windowType==l.n.Host?window.frames[e]:e&&e!=w.a.HOST_NAME?window.parent.frames[e]:window.parent}}]),S);function S(e){r()(this,S),this.windowType=e,this.listen()}t.a=y},224:function(e,t,n){"use strict";n.r(t);var a=n(2),i=n.n(a),r=n(5),o=n.n(r),c=n(3),l=n.n(c),s=n(24),m=n.n(s),d=n(12),h=n.n(d),u=n(6),f=n(0);function A(){var n=this;i()(this,A),this.iframeLoad=new h.a(function(e,t){n.iframeLoadSuccess=e,n.iframeLoadFailed=t}),this.initialize=new h.a(function(e,t){n.initializeSuccess=e,n.initializeFailed=t})}var w=(o()(A,[{key:"insertInside",value:function(e,t,n,a){var o=this,c=window.document.createElement("iframe");c.id=e,c.name=this.name,c.src=this.srcUrl,c.instance=this;var i="1.2em",r=m()({margin:"0",padding:"0",border:"none",overflow:"hidden",display:"block",minWidth:"100%",width:"1px",height:i},a);l()(r).forEach(function(e){c.style[e]=r[e]});var s=document.getElementById(e);if(s){if(c.id=c.id+"_frame",s.classList.add("CbHosted"),n&&r.height===i){n.container=s,this.componentField=n;var d=i;try{var u=n.parent.options.style.base.fontSize;~u.indexOf("px")&&(d=1.2*parseInt(u.replace("px",""))+"px"||i)}catch(e){}c.style.height=d}s.appendChild(c)}else t.insertBefore(c,null);return this.ref=c,new h.a(function(e,t){function n(){o.iframeLoadSuccess(),clearInterval(i),e(!0)}function a(){o.iframeLoadFailed(),clearInterval(i),t()}var i;c.onload=n;var r=0;i=setInterval(function(){window["cb-"+o.name+"-loaded"]?n():100<=++r&&a()},100),setTimeout(a,1e4)})}},{key:"insert",value:function(){var e=window.document.getElementById(u.a.CONTAINER);return this.insertInside(this.name,e)}},{key:"destroy",value:function(){this.ref.innerHTML="",this.componentField.container.removeChild(this.ref),delete this.ref,delete this.componentField}}],[{key:"masterFrame",value:function(e,t){var n=new A;return n.name=e,n.type=f.n.Master,n.srcUrl=t,n}},{key:"componentFrame",value:function(e,t){var n=new A;return n.name=e,n.type=f.n.Component,n.srcUrl=t,n}}]),A),g=n(4),p=n(54),v=n(168),y=n(26),S=n(273),R=n(7),E=n(13),M=n(21),F=n(17);n.d(t,"CHILD_IFRAME_NAME",function(){return T});var T=function(e,t){return"cb-component-"+e+"-"+t},b=function(){return"#"+encodeURIComponent(window.location.host)};function _(){i()(this,_),this.childFrames=[],this.connectionClient=new p.c(f.n.Host,!0),new v.a(f.n.Host),function(n){R.a.registerAction(f.h.Actions.TriggerEvent,{handle:function(e){var t=S.a.registry[e.data.frame];return y.a.notTrue(function(){return!!t},Object(M.d)(E.e.componentNotFound)),t.delegateEvent(e.data),new h.a(function(e,t){return e({acknowledged:!0})})}}),R.a.registerAction(f.h.Actions.ReceiveStatusBroadcast,{handle:function(e){var t=S.a.registry[e.data.frame];return y.a.notTrue(function(){return!!t},Object(M.d)(E.e.componentNotFound)),t.delegateEvent(e.data),new h.a(function(e,t){return e({acknowledged:!0})})}}),R.a.registerAction(f.h.Actions.SetPaymentIntent3DSResult,{handle:function(e){return n.send({action:f.l.Actions.SetPaymentIntent3DSResult,data:e.data},u.a.MASTER_FRAME)}}),R.a.registerAction(f.h.Actions.SetAdyen3DS1VerificationResult,{handle:function(e){return n.send({action:f.l.Actions.SetAdyen3DS1VerificationResult,data:e.data},u.a.MASTER_FRAME)}}),R.a.registerAction(f.l.Actions.SetCheckoutCom3DSVerificationResult,{handle:function(e){return n.send({action:f.l.Actions.SetCheckoutCom3DSVerificationResult,data:e.data},u.a.MASTER_FRAME)}}),R.a.registerAction(f.l.Actions.SetCybersource3DSVerificationResult,{handle:function(e){return n.send({action:f.l.Actions.SetCybersource3DSVerificationResult,data:e.data},u.a.MASTER_FRAME)}}),R.a.registerAction(f.h.Actions.SetAdyenIDealVerificationResult,{handle:function(e){try{n.send({action:f.l.Actions.CaptureKVL,data:m()({action:"iDeal_set_verification_result"},Object(F.h)(e.data))},u.a.MASTER_FRAME)}catch(e){}return n.send({action:f.l.Actions.SetAdyenIDealVerificationResult,data:e.data},u.a.MASTER_FRAME)}}),R.a.registerAction(f.h.Actions.SetStripeIDealVerificationResult,{handle:function(e){try{n.send({action:f.l.Actions.CaptureKVL,data:m()({action:"iDeal_set_verification_result"},Object(F.h)(e.data))},u.a.MASTER_FRAME)}catch(e){}return n.send({action:f.l.Actions.SetStripeIDealVerificationResult,data:e.data},u.a.MASTER_FRAME)}}),R.a.registerAction(f.h.Actions.SetAdyenSofortVerificationResult,{handle:function(e){return n.send({action:f.l.Actions.SetAdyenSofortVerificationResult,data:e.data},u.a.MASTER_FRAME)}}),R.a.registerAction(f.h.Actions.SetAdyenBancontactVerificationResult,{handle:function(e){return n.send({action:f.l.Actions.SetAdyenBancontactVerificationResult,data:e.data},u.a.MASTER_FRAME)}}),R.a.registerAction(f.h.Actions.SetAdyenGiropayVerificationResult,{handle:function(e){return n.send({action:f.l.Actions.SetAdyenGiropayVerificationResult,data:e.data},u.a.MASTER_FRAME)}}),R.a.registerAction(f.h.Actions.SetAdyenDotpayVerificationResult,{handle:function(e){return n.send({action:f.l.Actions.SetAdyenDotpayVerificationResult,data:e.data},u.a.MASTER_FRAME)}}),R.a.registerAction(f.h.Actions.SetFrameLoaded,{handle:function(e){return window["cb-"+e.data.frame+"-loaded"]=!0,h.a.resolve({acknowledged:!0})}}),R.a.registerAction(f.h.Actions.CaptureKVL,{handle:function(e){return n.send({action:f.l.Actions.CaptureKVL,data:e.data},u.a.MASTER_FRAME)}}),R.a.registerAction(f.h.Actions.CaptureException,{handle:function(e){return n.send({action:f.l.Actions.CaptureException,data:e.data},u.a.MASTER_FRAME)}}),R.a.registerAction(f.h.Actions.SetAuthToken,{handle:function(e){return n.send({action:f.l.Actions.SetHpData,data:{jwt:Object(F.j)(e,"data.jwt")||""}},u.a.MASTER_FRAME)}}),R.a.registerAction(f.h.Actions.SetCustomerHandle,{handle:function(e){return n.send({action:f.l.Actions.SetHpData,data:{customer_handle:Object(F.j)(e,"data.customer_handle")||""}},u.a.MASTER_FRAME)}}),R.a.registerAction(f.h.Actions.SetPreviewPortalEmail,{handle:function(e){var t=Object(F.j)(e,"data.email")||"";return n.send({action:f.l.Actions.SetHpData,data:{preview_portal_email:t}},u.a.MASTER_FRAME)}}),R.a.registerAction(f.h.Actions.GetPreviewPortalEmail,{handle:function(){return n.send({action:f.l.Actions.GetHpData,data:{param:"preview_portal_email"}},u.a.MASTER_FRAME).then(function(e){var t=e.preview_portal_email,n=document.getElementById("cb-frame");return n&&t&&n.contentWindow.postMessage({action:"setPreviewPortalEmail",referrer:"chargebeejs",data:{preview_portal_email:t}},"*"),e})}}),R.a.registerAction(f.h.Actions.ShowFrame,{handle:function(e){return document.querySelector("iframe[name="+e.data+"]").style.display="block",new h.a(function(e,t){return e({acknowledged:!0})})}}),R.a.registerAction(f.h.Actions.HideFrame,{handle:function(e){return document.querySelector("iframe[name="+e.data+"]").style.display="none",new h.a(function(e,t){return e({acknowledged:!0})})}})}(this)}var C=new(o()(_,[{key:"createMasterFrame",value:function(){var t=this;return this.checkMasterInitialized()||(this.masterFrame=w.masterFrame(p.b,g.a.getJSDomain()+"/v2/master-900189a22f5c5931f056eb8af869e235.html"+b()),this.commMgrReady=this.masterFrame.insert().then(function(){var e={action:f.l.Actions.RegisterMaster,data:{host:window.location.origin,site:g.a.getCbInstance().site,publishableKey:g.a.getCbInstance().publishableKey,options:g.a.getCbInstance().options,window_url:window.location.href}};return t.register(e,t.masterFrame)}).catch(function(e){t.masterFrame.initializeFailed(),console.error(Object(M.d)(E.e.errorMountingMaster)),e&&console.error(e)})),this.commMgrReady}},{key:"createCbFrame",value:function(e,t){var n=this,a=e.id,i=e.fieldType,r=(e.options,w.componentFrame(T.apply(null,[i,this.childFrames.length]),g.a.getJSDomain()+"/v2/component-900189a22f5c5931f056eb8af869e235.html"+b()));return this.childFrames.push(r),r.insertInside(a,t,e).then(function(){return n.masterFrame.initialize}).then(function(){return r})}},{key:"createIDealFrame",value:function(e,t,n){var a=this,i=e.id,r=e.fieldType,o=w.componentFrame(T.apply(null,[r,this.childFrames.length]),g.a.getJSDomain()+"/v2/component-900189a22f5c5931f056eb8af869e235.html"+b());return this.childFrames.push(o),o.insertInside(i,t,e,n).then(function(){return a.masterFrame.initialize}).then(function(){return o})}},{key:"register",value:function(e,t){var n=this;return this.masterFrame.iframeLoad.then(function(){return n.connectionClient.sendMessage(e,p.b,{timeout:1e4})}).then(function(){return t.initializeSuccess(),{registered:!0}}).catch(function(e){return t.initializeFailed(e),{registered:!1}})}},{key:"checkMasterInitialized",value:function(){var e=document.getElementById(p.b);return!this.masterFrame&&e&&(this.masterFrame=e.instance),!!this.masterFrame&&!!e}},{key:"send",value:function(e,t,n){var a=this;return this.createMasterFrame().then(function(){return a.masterFrame.initialize}).then(function(){return a.connectionClient.sendMessage(e,t,n)})}},{key:"listen",value:function(e){this.connectionClient.receiver.listen(e)}},{key:"deregister",value:function(t){this.childFrames=this.childFrames.filter(function(e){return e.name!==t})}}]),_);t.default=C},273:function(e,t,n){"use strict";var a=n(2),i=n.n(a),r=n(5),o=(n.n(r)()(c,null,[{key:"register",value:function(e,t){this.registry[t]=e}}]),c);function c(){i()(this,c)}o.registry={},t.a=o},7:function(e,t,n){"use strict";var a=n(2),i=n.n(a),r=n(5);function o(){i()(this,o),this.actionRegistry={}}var c=new(n.n(r)()(o,[{key:"registerAction",value:function(e,t){this.actionRegistry[e]=t}},{key:"resolve",value:function(e){var t=this.actionRegistry[e.action];if(t&&t.handle)return t.handle(e);console.log("Unknown action: "+t)}}]),o);t.a=c}}]);
//# sourceMappingURL=91-e761c28dbb49d9d6d624.js.map